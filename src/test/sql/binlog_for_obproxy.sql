-- 基础测试
--------------------------------------------------------------------------------------------------------------------
SHOW
    MASTER STATUS;
-- +-------------+----------+--------------+------------------+-------------------+
-- | File        | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |
-- +-------------+----------+--------------+------------------+-------------------+
-- | mysql-bin.02| 72578406 |              |                  |                   |
-- +-------------+----------+--------------+------------------+-------------------+
-- 1 row in set (0.37 sec)
---------------------------------------------------------------------------------------------------------------------
SHOW
    BINARY LOGS;
-- +-------------+-----------+
-- | Log_name    | File_size |
-- +-------------+-----------+
-- | mysql-bin.1 |     12543 |
-- | mysql-bin.2 |  72578406 |
-- +-------------+-----------+
-- 2 rows in set (0.09 sec)
---------------------------------------------------------------------------------------------------------------------
SHOW
    BINLOG EVENTS LIMIT 2;
SHOW
    BINLOG EVENTS;
SHOW
    BINLOG EVENTS FROM 11880;
SHOW
    BINLOG EVENTS FROM 11880 LIMIT 2;
SHOW
    BINLOG EVENTS FROM 11880 LIMIT 2, 2;

-- mysql> show binlog events limit 2;
-- +-------------+------+----------------+------------+-------------+-----------------------------------------------------------+
-- | Log_name    | Pos  | Event_type     | Server_id  | End_log_pos | Info                                                      |
-- +-------------+------+----------------+------------+-------------+-----------------------------------------------------------+
-- | mysql-bin.1 |    4 | Format_desc    | 1147473732 | 123         | 5.7.38r:"100.88.106.71:26024", t:1666860984489121}ysql/mQ |
-- | mysql-bin.1 |  123 | Previous_gtids | 1147473732 | 190         |                                                           |
-- +-------------+------+----------------+------------+-------------+-----------------------------------------------------------+
-- 2 rows in set (0.13 sec)
--
--
--
-- mysql> show binlog events;
-- +-------------+-------+----------------+------------+-------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
-- | Log_name    | Pos   | Event_type     | Server_id  | End_log_pos | Info                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
-- +-------------+-------+----------------+------------+-------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
-- | mysql-bin.1 |     4 | Format_desc    | 1147473732 | 123         | 5.7.38r:"100.88.106.71:26024", t:1666860984489121}ysql/mQ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
-- | mysql-bin.1 |   123 | Previous_gtids | 1147473732 | 190         |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
-- | mysql-bin.1 |   190 | Gtid           | 1147473732 | 251         |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
-- | mysql-bin.1 |   251 | Query          | 1147473732 | 294         | BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
-- | mysql-bin.1 |   294 | Table_map      | 1147473732 | 382         |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
-- | mysql-bin.1 |   382 | Write_rows     | 1147473732 | 10015       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
-- | mysql-bin.1 | 10015 | Xid            | 1147473732 | 10042       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
-- | mysql-bin.1 | 10042 | Query          | 1147473732 | 10698       | create table `act_re_procdef_` (
--                                                                                                                                                                            `ID_` varchar(64) not null,
--                                                                                                                                                                            `REV_` int,
--                                                                                                                                                                            `CATEGORY_` varchar(255),
--                                                                                                                                                                            `NAME_` varchar(255),
--                                                                                                                                                                            `KEY_` varchar(255) not null,
--                                                                                                                                                                            `VERSION_` int not null,
--                                                                                                                                                                            `DEPLOYMENT_ID_` varchar(64),
--                                                                                                                                                                            `RESOURCE_NAME_` varchar(4000),
--                                                                                                                                                                            `DGRM_RESOURCE_NAME_` varchar(4000),
--                                                                                                                                                                            `DESCRIPTION_` varchar(4000),
--                                                                                                                                                                            `HAS_START_FORM_KEY_` tinyint,
--                                                                                                                                                                            `HAS_GRAPHICAL_NOTATION_` tinyint,
--                                                                                                                                                                            `SUSPENSION_STATE_` int,
--                                                                                                                                                                            `TENANT_ID_` varchar(255) default '',
--                                                                                                                                                                            primary key (`ID_`),
--                                                                                                                                                                            constraint `ACT_UNIQ_PROCDEF` unique key (`KEY_`, `VERSION_`, `TENANT_ID_`)
--                                                                     )
--     default charset=utf8mb4
-- default collate=utf8mb4_bin?                                                                                                                                                                                                                                                                                                                                                                                                                                        |
-- | mysql-bin.1 | 10698 | Query          | 1147473732 | 11880       | create table `act_ru_execution_` (
--                                                                                                              `ID_` varchar(64) not null default '',
--                                                                                                              `REV_` int,
--                                                                                                              `PROC_INST_ID_` varchar(64),
--                                                                                                              `BUSINESS_KEY_` varchar(255),
--                                                                                                              `PARENT_ID_` varchar(64),
--                                                                                                              `PROC_DEF_ID_` varchar(64),
--                                                                                                              `SUPER_EXEC_` varchar(64),
--                                                                                                              `ACT_ID_` varchar(255),
--                                                                                                              `IS_ACTIVE_` tinyint,
--                                                                                                              `IS_CONCURRENT_` tinyint,
--                                                                                                              `IS_SCOPE_` tinyint,
--                                                                                                              `IS_EVENT_SCOPE_` tinyint,
--                                                                                                              `SUSPENSION_STATE_` int,
--                                                                                                              `CACHED_ENT_STATE_` int,
--                                                                                                              `TENANT_ID_` varchar(255) default '',
--                                                                                                              `NAME_` varchar(255),
--                                                                                                              `LOCK_TIME_` timestamp(3),
--                                                                                                              primary key (`ID_`),
--                                                                                                              constraint `ACT_FK_EXE_PARENT` foreign key (`PARENT_ID_`) references `act_ru_execution_` (`ID_`) ON DELETE RESTRICT ON UPDATE RESTRICT,
--                                                                                                              constraint `ACT_FK_EXE_PROCDEF` foreign key (`PROC_DEF_ID_`) references `act_re_procdef_` (`ID_`) ON DELETE RESTRICT ON UPDATE RESTRICT,
--                                                                                                              constraint `ACT_FK_EXE_PROCINST` foreign key (`PROC_INST_ID_`) references `act_ru_execution_` (`ID_`) ON DELETE CASCADE ON UPDATE CASCADE,
--                                                                                                              constraint `ACT_FK_EXE_SUPER` foreign key (`SUPER_EXEC_`) references `act_ru_execution_` (`ID_`) ON DELETE RESTRICT ON UPDATE RESTRICT
--                                                                     )
--     default charset=utf8mb4
-- default collate=utf8mb4_bin犕 |
-- | mysql-bin.1 | 11880 | Query          | 1147473732 | 12010       | create index `ACT_FK_EXE_PARENT` on `act_ru_execution_` (`PARENT_ID_` ASC)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
-- | mysql-bin.1 | 12010 | Query          | 1147473732 | 12143       | create index `ACT_FK_EXE_PROCDEF` on `act_ru_execution_` (`PROC_DEF_ID_` ASC)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
-- | mysql-bin.1 | 12143 | Query          | 1147473732 | 12278       | create index `ACT_FK_EXE_PROCINST` on `act_ru_execution_` (`PROC_INST_ID_` ASC)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
-- | mysql-bin.1 | 12278 | Query          | 1147473732 | 12408       | create index `ACT_FK_EXE_SUPER` on `act_ru_execution_` (`SUPER_EXEC_` ASC) ASC)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
-- | mysql-bin.1 | 12408 | Query          | 1147473732 | 12543       | create index `ACT_IDX_EXEC_BUSKEY` on `act_ru_execution_` (`BUSINESS_KEY_` ASC)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
-- +-------------+-------+----------------+------------+-------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
-- 14 rows in set (0.09 sec)
--
--
--
-- mysql> show binlog events from 11880;
-- +-------------+-------+------------+------------+-------------+---------------------------------------------------------------------------------+
-- | Log_name    | Pos   | Event_type | Server_id  | End_log_pos | Info                                                                            |
-- +-------------+-------+------------+------------+-------------+---------------------------------------------------------------------------------+
-- | mysql-bin.1 | 11880 | Query      | 1147473732 | 12010       | create index `ACT_FK_EXE_PARENT` on `act_ru_execution_` (`PARENT_ID_` ASC)      |
-- | mysql-bin.1 | 12010 | Query      | 1147473732 | 12143       | create index `ACT_FK_EXE_PROCDEF` on `act_ru_execution_` (`PROC_DEF_ID_` ASC)   |
-- | mysql-bin.1 | 12143 | Query      | 1147473732 | 12278       | create index `ACT_FK_EXE_PROCINST` on `act_ru_execution_` (`PROC_INST_ID_` ASC) |
-- | mysql-bin.1 | 12278 | Query      | 1147473732 | 12408       | create index `ACT_FK_EXE_SUPER` on `act_ru_execution_` (`SUPER_EXEC_` ASC) ASC) |
-- | mysql-bin.1 | 12408 | Query      | 1147473732 | 12543       | create index `ACT_IDX_EXEC_BUSKEY` on `act_ru_execution_` (`BUSINESS_KEY_` ASC) |
-- +-------------+-------+------------+------------+-------------+---------------------------------------------------------------------------------+
-- 5 rows in set (0.09 sec)
--
--
-- mysql> show binlog events from 11880 limit 2;
-- +-------------+-------+------------+------------+-------------+-------------------------------------------------------------------------------+
-- | Log_name    | Pos   | Event_type | Server_id  | End_log_pos | Info                                                                          |
-- +-------------+-------+------------+------------+-------------+-------------------------------------------------------------------------------+
-- | mysql-bin.1 | 11880 | Query      | 1147473732 | 12010       | create index `ACT_FK_EXE_PARENT` on `act_ru_execution_` (`PARENT_ID_` ASC)    |
-- | mysql-bin.1 | 12010 | Query      | 1147473732 | 12143       | create index `ACT_FK_EXE_PROCDEF` on `act_ru_execution_` (`PROC_DEF_ID_` ASC) |
-- +-------------+-------+------------+------------+-------------+-------------------------------------------------------------------------------+
-- 2 rows in set (0.10 sec)
--
--
-- show binlog events from 11880 limit 2, 2;
-- +-------------+-------+------------+------------+-------------+-------------------------------------------------------------------------------------+
-- | Log_name    | Pos   | Event_type | Server_id  | End_log_pos | Info                                                                                |
-- +-------------+-------+------------+------------+-------------+-------------------------------------------------------------------------------------+
-- | mysql-bin.1 | 12143 | Query      | 1147473732 | 12278       | create index `ACT_FK_EXE_PROCINST` on `act_ru_execution_` (`PROC_INST_ID_` ASC)in.2 |
-- | mysql-bin.1 | 12278 | Query      | 1147473732 | 12408       | create index `ACT_FK_EXE_SUPER` on `act_ru_execution_` (`SUPER_EXEC_` ASC) ASC)in.2 |
-- +-------------+-------+------------+------------+-------------+-------------------------------------------------------------------------------------+
-- 2 rows in set (0.10 sec)

--------------------------------------------------------------------------------------------------------------------
PURGE
    BINARY LOGS TO 'mysql-bin.1';
PURGE
    BINARY LOGS BEFORE '2019-04-02 22:46:26';
-- mysql> PURGE BINARY LOGS TO 'mysql-bin.1';
-- Query OK, 0 rows affected (0.10 sec)
--
--
-- mysql> PURGE BINARY LOGS BEFORE '2019-04-02';
-- Query OK, 0 rows affected (0.10 sec)

--------------------------------------------------------------------------------------------------------------------
SHOW
BINLOG
SERVER;

-- mysql> show binlog server for tenant `cluster_1`.`tenant_100`;
-- +-----------+------------+--------------+-------+--------+-------+
-- | cluster   | tenant     | ip           | port  | status | cause |
-- +-----------+------------+--------------+-------+--------+-------+
-- | cluster_1 | tenant_100 | 11.124.9.122 | 60600 | OK     |  NULL |
-- +-----------+------------+--------------+-------+--------+-------+
-- 1 row in set (0.09 sec)

--------------------------------------------------------------------------------------------------------------------
SHOW
    SLAVE STATUS;

--------------------------------------------------------------------------------------------------------------------
RESET
    MASTER;
--------------------------------------------------------------------------------------------------------------------
FLUSH
    BINARY LOGS;
--------------------------------------------------------------------------------------------------------------------

SET
    GLOBAL GTID_MODE = VALUE;
SET
    @@GLOBAL.GTID_MODE = VALUE;


SHOW
    GLOBAL VARIABLES LIKE 'GTID_MODE';
SELECT @@GLOBAL.GTID_MODE;

---------------------------------------------------------------------------------------------------------------------

SET
    GLOBAL GTID_EXECUTED = VALUE;
SET
    @@GLOBAL.GTID_EXECUTED = VALUE;


SHOW
    GLOBAL VARIABLES LIKE 'GTID_EXECUTED';
SELECT @@GLOBAL.GTID_EXECUTED;

--------------------------------------------------------------------------------------------------------------------


-- 函数转发测试
SELECT GTID_SUBTRACT('4849646f-4dc7-11ed-85a9-7cd30abc99b4:1-9', '4849646f-4dc7-11ed-85a9-7cd30abc99b4:1-9');
SELECT GTID_SUBTRACT('', '');

-- 事务内测试


-------------